import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('ðŸŒ± Seeding Infrastructure & Logistics data...');

  // Create Ukrainian infrastructure assets
  const kyivBridge = await prisma.asset.create({
    data: {
      type: 'BRIDGE',
      name: 'Pivnichnyi Bridge (Kyiv)',
      description: 'Major bridge crossing Dnipro River in Kyiv, critical infrastructure',
      status: 'UNDER_REPAIR',
      location: {
        latitude: 50.4851,
        longitude: 30.4721,
        city: 'Kyiv',
        region: 'Kyiv Oblast',
        country: 'UA',
      },
      ownerId: 'ministry-infrastructure-ua',
      operatorId: 'kyiv-city-transport',
      specifications: {
        length: '1200m',
        lanes: 6,
        yearBuilt: 1976,
        lastInspection: '2024-08-15',
      },
      capacity: {
        value: 50000,
        unit: 'vehicles/day',
      },
      constructionCost: {
        amount: 15000000,
        currency: 'USD',
      },
      estimatedValue: {
        amount: 45000000,
        currency: 'USD',
      },
      tags: ['critical-infrastructure', 'dnipro-crossing', 'reconstruction'],
      metadata: {
        damageLevel: 'moderate',
        repairPriority: 'high',
        fundingSource: 'USAID',
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  const lvivHospital = await prisma.asset.create({
    data: {
      type: 'HOSPITAL',
      name: 'Lviv Regional Clinical Hospital',
      description: 'Major medical facility serving Western Ukraine',
      status: 'OPERATIONAL',
      location: {
        latitude: 49.8397,
        longitude: 24.0297,
        city: 'Lviv',
        region: 'Lviv Oblast',
        country: 'UA',
      },
      ownerId: 'ministry-health-ua',
      specifications: {
        beds: 500,
        departments: 12,
        emergencyCapacity: 'Level 1 Trauma Center',
      },
      capacity: {
        value: 500,
        unit: 'beds',
      },
      estimatedValue: {
        amount: 25000000,
        currency: 'USD',
      },
      tags: ['healthcare', 'operational', 'western-ukraine'],
      metadata: {
        specializations: ['trauma', 'cardiology', 'pediatrics'],
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  const kharkivSchool = await prisma.asset.create({
    data: {
      type: 'SCHOOL',
      name: 'Kharkiv School #47',
      description: 'Primary and secondary school, damaged during conflict',
      status: 'UNDER_CONSTRUCTION',
      location: {
        latitude: 50.0041,
        longitude: 36.2311,
        city: 'Kharkiv',
        region: 'Kharkiv Oblast',
        country: 'UA',
      },
      ownerId: 'ministry-education-ua',
      specifications: {
        capacity: 800,
        grades: '1-11',
        facilities: ['computer lab', 'gym', 'cafeteria'],
      },
      capacity: {
        value: 800,
        unit: 'students',
      },
      constructionCost: {
        amount: 3500000,
        currency: 'USD',
      },
      tags: ['education', 'reconstruction', 'world-bank'],
      metadata: {
        damageAssessment: 'severe',
        reconstructionStart: '2024-03-01',
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  // More assets...
  const odesaPort = await prisma.asset.create({
    data: {
      type: 'PORT',
      name: 'Port of Odesa',
      description: 'Major Black Sea port, critical for grain exports',
      status: 'OPERATIONAL',
      location: {
        latitude: 46.4825,
        longitude: 30.7233,
        city: 'Odesa',
        region: 'Odesa Oblast',
        country: 'UA',
      },
      ownerId: 'ministry-infrastructure-ua',
      operatorId: 'odesa-port-authority',
      specifications: {
        dockingCapacity: 25,
        storageCapacity: '500000 tons',
        handlingEquipment: ['cranes', 'loaders', 'conveyors'],
      },
      capacity: {
        value: 500000,
        unit: 'tons/month',
      },
      estimatedValue: {
        amount: 150000000,
        currency: 'USD',
      },
      tags: ['port', 'grain-corridor', 'critical-infrastructure'],
      metadata: {
        grainExports: true,
        blackSeaAccess: true,
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  console.log('âœ… Created 4 infrastructure assets');

  // Create reconstruction projects
  const bridgeProject = await prisma.project.create({
    data: {
      name: 'Pivnichnyi Bridge Reconstruction',
      description: 'Emergency repair and reinforcement of critical Kyiv bridge',
      phase: 'CONSTRUCTION',
      startDate: new Date('2024-06-01'),
      plannedEndDate: new Date('2025-12-31'),
      budget: {
        amount: 18000000,
        currency: 'USD',
      },
      spent: {
        amount: 7200000,
        currency: 'USD',
      },
      committed: {
        amount: 10800000,
        currency: 'USD',
      },
      donorIds: ['usaid', 'world-bank'],
      implementerId: 'ministry-infrastructure-ua',
      contractorIds: ['ukrainian-bridge-builders', 'euro-construction'],
      progressPercentage: 40,
      tags: ['usaid-funded', 'critical-infrastructure', 'kyiv'],
      metadata: {
        contractValue: 18000000,
        expectedCompletion: '2025-Q4',
        workingDays: 450,
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  const schoolProject = await prisma.project.create({
    data: {
      name: 'Kharkiv Schools Reconstruction Program',
      description: 'Rebuild 5 damaged schools in Kharkiv region',
      phase: 'PROCUREMENT',
      startDate: new Date('2024-09-01'),
      plannedEndDate: new Date('2026-08-31'),
      budget: {
        amount: 15000000,
        currency: 'USD',
      },
      spent: {
        amount: 1500000,
        currency: 'USD',
      },
      committed: {
        amount: 4500000,
        currency: 'USD',
      },
      donorIds: ['world-bank', 'eu'],
      implementerId: 'ministry-education-ua',
      contractorIds: [],
      progressPercentage: 15,
      tags: ['world-bank', 'education', 'kharkiv'],
      metadata: {
        schoolsIncluded: 5,
        studentsImpacted: 3500,
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  // Link projects to assets
  await prisma.projectAsset.create({
    data: {
      projectId: bridgeProject.id,
      assetId: kyivBridge.id,
    },
  });

  await prisma.projectAsset.create({
    data: {
      projectId: schoolProject.id,
      assetId: kharkivSchool.id,
    },
  });

  console.log('âœ… Created 2 projects with asset linkages');

  // Create cargo shipments
  const constructionCargo = await prisma.cargo.create({
    data: {
      type: 'CONSTRUCTION_MATERIALS',
      description: 'Steel beams and concrete for bridge reconstruction',
      quantity: {
        value: 150,
        unit: 'ton',
      },
      declaredValue: {
        amount: 450000,
        currency: 'USD',
      },
      hsCode: '7308.90',
      dangerous: false,
      temperatureControlled: false,
      consignorId: 'polish-steel-company',
      consigneeId: 'ukrainian-bridge-builders',
      projectId: bridgeProject.id,
      assetId: kyivBridge.id,
      metadata: {
        supplier: 'ArcelorMittal Poland',
        deliveryPriority: 'high',
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  const medicalCargo = await prisma.cargo.create({
    data: {
      type: 'MEDICAL_SUPPLIES',
      description: 'Emergency medical equipment and supplies',
      quantity: {
        value: 5,
        unit: 'ton',
      },
      declaredValue: {
        amount: 125000,
        currency: 'USD',
      },
      hsCode: '9018.90',
      dangerous: false,
      temperatureControlled: true,
      consignorId: 'usaid-humanitarian',
      consigneeId: 'lviv-hospital',
      assetId: lvivHospital.id,
      metadata: {
        donor: 'USAID',
        contents: ['surgical equipment', 'medications', 'diagnostic tools'],
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  console.log('âœ… Created 2 cargo records');

  // Create transport routes
  const polandKyivRoute = await prisma.route.create({
    data: {
      name: 'Poland â†’ Kyiv (Construction Materials)',
      mode: 'MULTIMODAL',
      origin: {
        latitude: 52.2297,
        longitude: 21.0122,
        city: 'Warsaw',
        country: 'PL',
      },
      destination: {
        latitude: 50.4501,
        longitude: 30.5234,
        city: 'Kyiv',
        country: 'UA',
      },
      legs: [
        {
          id: 'leg-1',
          sequence: 1,
          mode: 'ROAD',
          from: { city: 'Warsaw', country: 'PL' },
          to: { city: 'PrzemyÅ›l', country: 'PL' },
          distance: { value: 350, unit: 'km' },
          estimatedDuration: 4,
        },
        {
          id: 'leg-2',
          sequence: 2,
          mode: 'RAIL',
          from: { city: 'PrzemyÅ›l', country: 'PL' },
          to: { city: 'Lviv', country: 'UA' },
          distance: { value: 85, unit: 'km' },
          estimatedDuration: 3,
        },
        {
          id: 'leg-3',
          sequence: 3,
          mode: 'ROAD',
          from: { city: 'Lviv', country: 'UA' },
          to: { city: 'Kyiv', country: 'UA' },
          distance: { value: 540, unit: 'km' },
          estimatedDuration: 8,
        },
      ],
      totalDistance: {
        value: 975,
        unit: 'km',
      },
      estimatedDuration: 15,
      preferredCarriers: ['polish-transport', 'ukraine-rail'],
      restrictions: ['oversize-load'],
      metadata: {
        borderCrossing: 'PrzemyÅ›l-Medyka',
        customsClearance: 'required',
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  console.log('âœ… Created 1 transport route');

  // Create shipment
  const activeShipment = await prisma.shipment.create({
    data: {
      status: 'IN_TRANSIT',
      routeId: polandKyivRoute.id,
      plannedDeparture: new Date('2025-01-10T08:00:00Z'),
      actualDeparture: new Date('2025-01-10T09:15:00Z'),
      estimatedArrival: new Date('2025-01-12T18:00:00Z'),
      currentLocation: {
        latitude: 49.8397,
        longitude: 24.0297,
        city: 'Lviv',
        country: 'UA',
      },
      lastUpdate: new Date(),
      carrierId: 'polish-transport',
      vehicleId: 'TRUCK-PL-12345',
      events: [
        {
          id: 'evt-1',
          timestamp: new Date('2025-01-10T09:15:00Z'),
          type: 'departure',
          location: { city: 'Warsaw', country: 'PL' },
          description: 'Departed from Warsaw depot',
        },
        {
          id: 'evt-2',
          timestamp: new Date('2025-01-11T14:30:00Z'),
          type: 'customs-entry',
          location: { city: 'PrzemyÅ›l', country: 'PL' },
          description: 'Customs clearance at Poland-Ukraine border',
        },
        {
          id: 'evt-3',
          timestamp: new Date('2025-01-11T18:00:00Z'),
          type: 'arrival',
          location: { city: 'Lviv', country: 'UA' },
          description: 'Arrived at Lviv distribution center',
        },
      ],
      projectId: bridgeProject.id,
      assetId: kyivBridge.id,
      metadata: {
        trackingNumber: 'SHIP-2025-001',
        priority: 'high',
      },
      createdBy: 'system',
      updatedBy: 'system',
    },
  });

  // Link cargo to shipment
  await prisma.shipmentCargo.create({
    data: {
      shipmentId: activeShipment.id,
      cargoId: constructionCargo.id,
    },
  });

  console.log('âœ… Created 1 active shipment with cargo linkage');

  // Create risk scores
  await prisma.riskScore.create({
    data: {
      entityType: 'PROJECT',
      entityId: bridgeProject.id,
      score: 35,
      severity: 'MEDIUM',
      status: 'INVESTIGATING',
      factors: [
        {
          type: 'budget-variance',
          score: 15,
          description: 'Budget spent 40% vs 40% progress - on track',
          detectedAt: new Date().toISOString(),
        },
        {
          type: 'schedule-delay',
          score: 20,
          description: 'Minor delays due to material delivery',
          evidence: ['shipment-delay-report-2024-12'],
          detectedAt: new Date().toISOString(),
        },
      ],
      assignedTo: 'risk-manager-ua',
      notes: 'Monitoring material delivery timelines',
      createdBy: 'ai-risk-engine',
      updatedBy: 'ai-risk-engine',
    },
  });

  await prisma.riskScore.create({
    data: {
      entityType: 'SHIPMENT',
      entityId: activeShipment.id,
      score: 12,
      severity: 'LOW',
      status: 'RESOLVED',
      factors: [
        {
          type: 'minor-delay',
          score: 12,
          description: 'Shipment departed 1 hour behind schedule',
          detectedAt: new Date('2025-01-10T09:00:00Z').toISOString(),
        },
      ],
      notes: 'Delay recovered during transit',
      createdBy: 'ai-risk-engine',
      updatedBy: 'ai-risk-engine',
    },
  });

  console.log('âœ… Created 2 risk scores');

  // Create timeline events
  await prisma.timelineEvent.create({
    data: {
      type: 'project.started',
      entityType: 'project',
      entityId: bridgeProject.id,
      title: 'Bridge Reconstruction Project Started',
      description: 'USAID-funded reconstruction of Pivnichnyi Bridge commenced',
      actor: 'ministry-infrastructure-ua',
      metadata: {
        budget: 18000000,
        duration: '18 months',
      },
    },
  });

  await prisma.timelineEvent.create({
    data: {
      type: 'shipment.in-transit',
      entityType: 'shipment',
      entityId: activeShipment.id,
      title: 'Construction Materials En Route to Kyiv',
      description: '150 tons of steel beams currently in Lviv, heading to bridge site',
      actor: 'polish-transport',
      metadata: {
        currentLocation: 'Lviv',
        eta: '2025-01-12',
      },
    },
  });

  console.log('âœ… Created 2 timeline events');

  console.log('');
  console.log('ðŸŽ‰ Seeding complete!');
  console.log('');
  console.log('ðŸ“Š Summary:');
  console.log('  - 4 Infrastructure Assets (Bridge, Hospital, School, Port)');
  console.log('  - 2 Reconstruction Projects');
  console.log('  - 2 Cargo Shipments');
  console.log('  - 1 Transport Route');
  console.log('  - 1 Active Shipment');
  console.log('  - 2 Risk Scores');
  console.log('  - 2 Timeline Events');
  console.log('');
  console.log('ðŸš€ Open Prisma Studio: npx prisma studio');
  console.log('ðŸŒ Open Infrastructure Hub: http://localhost:3000/infrastructure-hub');
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
